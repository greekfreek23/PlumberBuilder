<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Single Template Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Inline CSS so no external file needed -->
  <style>
    /* Basic reset & container */
    * {
      margin: 0; 
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Arial", sans-serif;
      background: #f2f5f8;
      color: #333;
    }

    /* Preview section */
    .preview-container {
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .preview-container h1 {
      margin-bottom: 15px;
    }
    .preview-container p {
      margin-bottom: 15px;
      line-height: 1.4;
    }
    .template-frame {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 15px;
      background: #eee;
    }
    .primary-btn {
      background: #007bff;
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .primary-btn:hover {
      background: #005dc0;
    }

    /* WIZARD container (hidden by default) */
    .wizard-container {
      max-width: 800px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      display: none; /* hide by default */
    }
    .wizard-step {
      display: none;
    }
    .wizard-step.active {
      display: block;
    }
    h2 {
      margin-bottom: 10px;
    }
    .step-block {
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    .step-block img {
      max-width: 250px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    textarea {
      width: 100%;
      margin-top: 5px;
      min-height: 50px;
    }
    .secondary-btn {
      background: #e2e6ea;
      color: #333;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 4px;
      margin-right: 10px;
      font-size: 14px;
    }
    .secondary-btn:hover {
      background: #d6dade;
    }
    .rewrite-btn {
      background: #28a745;
      color: #fff;
      padding: 8px 14px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      margin-top: 5px;
    }
    .rewrite-btn:hover {
      background: #218838;
    }
    .step-nav {
      text-align: right;
    }
  </style>
</head>
<body>
  <!-- PREVIEW SECTION -->
  <div class="preview-container" id="previewContainer">
    <h1>Welcome to Your Plumber Template</h1>
    <p>
      This is our single template. Below is how your site currently looks 
      (with data from <code>finalWebsiteData.json</code>).
    </p>
    <iframe class="template-frame" id="templateFrame"></iframe>
    <button class="primary-btn" id="editSiteBtn">Edit This Site</button>
  </div>

  <!-- WIZARD SECTION -->
  <div class="wizard-container" id="wizardContainer">
    <!-- STEP 1: Logo & Hero -->
    <div class="wizard-step active" id="step1">
      <h2>Step 1: Logo & Hero</h2>
      <div class="step-block">
        <h3>Logo</h3>
        <img id="logoImg" alt="Current Logo"/>
        <div>
          <button class="secondary-btn" id="keepLogoBtn">Keep Existing</button>
          <button class="secondary-btn" id="uploadLogoBtn">Upload New</button>
          <button class="secondary-btn" id="generateLogoBtn">Generate (DALLÂ·E)</button>
        </div>
      </div>

      <div class="step-block">
        <h3>Hero</h3>
        <label>
          <input type="radio" name="heroType" value="single" checked/>Single Image
        </label>
        <label>
          <input type="radio" name="heroType" value="slider"/>Slider
        </label>
        <div id="heroSingleDiv" style="margin-top:10px;">
          <img id="heroSingleImg" alt="Hero Single"/>
          <p>Hero Headline:</p>
          <textarea id="heroHeadline"></textarea>
          <button class="rewrite-btn" id="rewriteHeroBtn">Rewrite with Claude</button>
        </div>
      </div>

      <div class="step-nav">
        <button class="primary-btn" id="step1NextBtn">Next: About Us</button>
      </div>
    </div>

    <!-- STEP 2: About Us -->
    <div class="wizard-step" id="step2">
      <h2>Step 2: About Us</h2>
      <div class="step-block">
        <label>
          <input type="radio" name="aboutImagesCount" value="1" checked/>One Image
        </label>
        <label>
          <input type="radio" name="aboutImagesCount" value="2"/>Two Images
        </label>

        <div id="aboutSingleDiv" style="margin-top:10px;">
          <img id="aboutSingleImg" alt="About Single"/>
        </div>
        <div id="aboutTwoDiv" style="display:none;">
          <img id="aboutImg1" alt="About1" style="max-width:200px; margin-right:20px;"/>
          <img id="aboutImg2" alt="About2" style="max-width:200px;"/>
        </div>

        <p style="margin-top:10px;">About Us Text:</p>
        <textarea id="aboutText"></textarea>
        <button class="rewrite-btn" id="rewriteAboutBtn">Rewrite with Claude</button>
      </div>

      <div class="step-nav">
        <button class="primary-btn" id="finishBtn">Finish</button>
      </div>
    </div>

    <!-- STEP 3: Finished -->
    <div class="wizard-step" id="finishedStep">
      <h2>All Done!</h2>
      <p>Your changes to the logo, hero, and about sections are noted. 
         You can integrate an actual "Publish" button to update finalWebsiteData.json or GitHub.
      </p>
      <button class="primary-btn" id="publishBtn">Publish (not implemented)</button>
      <button class="secondary-btn" id="backToPreviewBtn">Back to Preview</button>
    </div>
  </div>

  <script>
    (function(){
      let plumberData = null;

      // DOM references
      const previewContainer = document.getElementById("previewContainer");
      const wizardContainer  = document.getElementById("wizardContainer");

      const templateFrame    = document.getElementById("templateFrame");
      const editSiteBtn      = document.getElementById("editSiteBtn");

      // Step 1
      const step1            = document.getElementById("step1");
      const step1NextBtn     = document.getElementById("step1NextBtn");
      const logoImg          = document.getElementById("logoImg");
      const heroSingleImg    = document.getElementById("heroSingleImg");
      const heroHeadline     = document.getElementById("heroHeadline");
      const rewriteHeroBtn   = document.getElementById("rewriteHeroBtn");

      // Step 2
      const step2            = document.getElementById("step2");
      const finishBtn        = document.getElementById("finishBtn");
      const aboutSingleDiv   = document.getElementById("aboutSingleDiv");
      const aboutTwoDiv      = document.getElementById("aboutTwoDiv");
      const aboutSingleImg   = document.getElementById("aboutSingleImg");
      const aboutImg1        = document.getElementById("aboutImg1");
      const aboutImg2        = document.getElementById("aboutImg2");
      const aboutText        = document.getElementById("aboutText");
      const rewriteAboutBtn  = document.getElementById("rewriteAboutBtn");

      // Step Finished
      const finishedStep     = document.getElementById("finishedStep");
      const publishBtn       = document.getElementById("publishBtn");
      const backToPreviewBtn = document.getElementById("backToPreviewBtn");

      // On load, parse ?site= and fetch data
      window.addEventListener("DOMContentLoaded", initBuilder);

      async function initBuilder(){
        const params = new URLSearchParams(window.location.search);
        const slug = params.get("site");
        if(!slug) {
          alert("No ?site= param. Can't load data!");
          return;
        }
        // Load the data from your finalWebsiteData.json
        try {
          console.log("Fetching data for slug:", slug);
          const resp = await fetch("https://raw.githubusercontent.com/greekfreek23/alabamaplumbersnowebsite/main/finalWebsiteData.json");
          if(!resp.ok) throw new Error("Failed to fetch finalWebsiteData.json");
          const json = await resp.json();
          const arr = json.finalWebsiteData || [];
          plumberData = arr.find(b => (b.siteId||"").toLowerCase() === slug.toLowerCase());
          if(!plumberData) {
            console.warn("No data for that slug. Using fallback.");
            plumberData = {};
          }
          // Put their template in the iframe
          templateFrame.src = `https://greekfreek23.github.io/ALPlumbersSite/?site=${slug}`;
          console.log("Data loaded, plumberData:", plumberData);
        } catch(err) {
          console.error("Error loading plumber data:", err);
          plumberData = {};
        }
      }

      // "Edit This Site" => hide preview, show wizard
      editSiteBtn.addEventListener("click", () => {
        console.log("Clicked Edit This Site");
        previewContainer.style.display = "none";
        wizardContainer.style.display  = "block";

        // Load step1 data
        loadStep1();
      });

      function loadStep1(){
        step1.classList.add("active");
        step2.classList.remove("active");
        finishedStep.classList.remove("active");

        // Show existing logo
        logoImg.src = plumberData.logo || "https://via.placeholder.com/150";

        // Hero single image
        const heroImgs = plumberData.photos?.heroImages || [];
        if(heroImgs.length > 0) {
          heroSingleImg.src = heroImgs[0].imageUrl || "https://via.placeholder.com/600x300";
          heroHeadline.value = heroImgs[0].callToAction || "Welcome to Our Plumbing!";
        } else {
          heroSingleImg.src = "https://via.placeholder.com/600x300";
          heroHeadline.value = "";
        }
      }

      // Step1 -> Step2
      step1NextBtn.addEventListener("click", () => {
        step1.classList.remove("active");
        step2.classList.add("active");
        loadStep2();
      });

      function loadStep2(){
        // if aboutUsImages length = 2, show aboutTwoDiv
        const aboutArr = plumberData.photos?.aboutUsImages || [];
        if(aboutArr.length === 2) {
          aboutSingleDiv.style.display = "none";
          aboutTwoDiv.style.display    = "block";
          aboutImg1.src = aboutArr[0];
          aboutImg2.src = aboutArr[1];
        } else {
          aboutSingleDiv.style.display = "block";
          aboutTwoDiv.style.display    = "none";
          aboutSingleImg.src = aboutArr[0] || "https://via.placeholder.com/300x200";
        }
        aboutText.value = plumberData.aboutUs || "";
      }

      // Step2 -> Finished
      finishBtn.addEventListener("click", () => {
        step2.classList.remove("active");
        finishedStep.classList.add("active");
      });

      // "Publish" or "Back"
      publishBtn.addEventListener("click", () => {
        alert("Would push changes to GitHub or DB. Not implemented here.");
      });
      backToPreviewBtn.addEventListener("click", () => {
        wizardContainer.style.display = "none";
        previewContainer.style.display = "block";

        // reset wizard steps
        step1.classList.remove("active");
        step2.classList.remove("active");
        finishedStep.classList.remove("active");
      });

      // Example rewrite calls
      rewriteHeroBtn.addEventListener("click", () => {
        console.log("Rewrite hero text with Claude (placeholder)...");
        heroHeadline.value = heroHeadline.value + " [Rewritten by Claude!]";
      });
      rewriteAboutBtn.addEventListener("click", () => {
        console.log("Rewrite about text with Claude (placeholder)...");
        aboutText.value = aboutText.value + " [Rewritten by Claude!]";
      });
    })();
  </script>
</body>
</html>
